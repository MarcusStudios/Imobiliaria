import{j as e,d as A}from"./index-Cov3jxHx.js";import{c as S,e as V,r as t,L as w}from"./vendor-Bpbu6qE6.js";import{h as U,f as E,u as $,v as z,x as L,n as B}from"./firebase-DDoP64bi.js";import{o as G,u as W}from"./cloudinaryService-C03o_Z1U.js";import{A as _,y as J,z as X,X as Z,F as H}from"./icons-HRjz0DnP.js";const ae=()=>{const g=S(),{id:n}=V(),[C,h]=t.useState(!1),[x,j]=t.useState(!1),[q,p]=t.useState(0),[v,b]=t.useState([]),[m,f]=t.useState([]),[y,T]=t.useState([]),[s,u]=t.useState({titulo:"",descricao:"",tipo:"Venda",categoria:"Terreno",preco:0,precoAluguel:0,endereco:"",bairro:"",cidade:"A√ßail√¢ndia",dimensoes:"",topografia:"Plano",zoneamento:"Residencial",area:0,quartos:0,suites:0,banheiros:0,vagas:0,condominio:0,iptu:0,piscina:!1,churrasqueira:!1,elevador:!1,mobiliado:!1,portaria:!1,aceitaPet:!1,imagens:[],lat:-15.5518,lng:-54.298,ativo:!0,destaque:!1}),D=()=>{u({titulo:"Terreno de Teste "+Math.floor(Math.random()*1e3),descricao:"Excelente terreno plano, pronto para construir. Localiza√ß√£o privilegiada com f√°cil acesso e infraestrutura completa. √ìtima oportunidade de investimento.",tipo:"Venda",categoria:"Terreno",preco:1e5+Math.floor(Math.random()*2e5),precoAluguel:0,endereco:"Avenida de Teste, "+Math.floor(Math.random()*1e3),bairro:"Bairro Gen√©rico",cidade:"A√ßail√¢ndia",dimensoes:"12x30",topografia:"Plano",zoneamento:"Residencial",area:360+Math.floor(Math.random()*100),quartos:0,suites:0,banheiros:0,vagas:0,condominio:150,iptu:500,piscina:!1,churrasqueira:!1,elevador:!1,mobiliado:!1,portaria:!1,aceitaPet:!1,imagens:["https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1595844730298-b960fa25e985?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=800&q=80"],lat:-15.5518,lng:-54.298,ativo:!0,destaque:!0}),f(["https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1595844730298-b960fa25e985?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=800&q=80"]),b([]),T([])};t.useEffect(()=>{n&&(async()=>{h(!0);try{const a=await U(E(A,"imoveis",n));if(a.exists()){const r=a.data(),{id:l,...c}=r;u({...c,categoria:"Terreno"}),f(c.imagens||[])}else alert("Im√≥vel n√£o encontrado!"),g("/admin")}catch(a){console.error("Erro ao buscar:",a)}finally{h(!1)}})()},[n,g]);const i=o=>{const{name:a,value:r}=o.target,l=["preco","precoAluguel","area","condominio","iptu","lat","lng"].includes(a);u(c=>({...c,[a]:l?Number(r):r}))},P=o=>{const{name:a,checked:r}=o.target;u(l=>({...l,[a]:r}))},I=o=>{const a=o.target.files;if(!a||a.length===0)return;const r=Array.from(a);if(m.length+r.length>10){alert(`Voc√™ pode adicionar no m√°ximo 10 fotos. Atualmente h√° ${m.length} foto(s).`);return}if(r.filter(d=>d.size>5*1024*1024).length>0){alert("Algumas imagens s√£o muito grandes (m√°x 5MB). Por favor, comprima-as antes de fazer upload.");return}b(d=>[...d,...r]),r.forEach(d=>{const N=new FileReader;N.onloadend=()=>{f(F=>[...F,N.result])},N.readAsDataURL(d)})},M=o=>{f(a=>a.filter((r,l)=>l!==o)),b(a=>a.filter((r,l)=>l!==o)),n&&u(a=>({...a,imagens:a.imagens.filter((r,l)=>l!==o)}))},k=()=>{const o=[];return s.titulo.trim()||o.push("T√≠tulo √© obrigat√≥rio"),s.preco<=0&&o.push("Pre√ßo deve ser maior que zero"),s.tipo==="Ambos"&&(!s.precoAluguel||s.precoAluguel<=0)&&o.push('Pre√ßo de aluguel √© obrigat√≥rio quando o tipo √© "Ambos"'),s.endereco.trim()||o.push("Endere√ßo √© obrigat√≥rio"),s.bairro.trim()||o.push("Bairro √© obrigat√≥rio"),s.dimensoes?.trim()||o.push("Dimens√µes do terreno s√£o obrigat√≥rias"),s.area<=0&&o.push("√Årea total √© obrigat√≥ria"),m.length===0&&v.length===0&&o.push("Adicione pelo menos uma foto do terreno"),T(o),o.length===0},R=async o=>{if(o.preventDefault(),!k()){window.scrollTo({top:0,behavior:"smooth"});return}h(!0);try{let a=[...s.imagens];if(v.length>0){j(!0),p(0);const l=setInterval(()=>{p(d=>Math.min(d+10,90))},200),c=await W(v);a=[...a,...c],clearInterval(l),p(100),j(!1)}const r={...s,imagens:a,categoria:"Terreno"};r.tipo!=="Ambos"&&(r.precoAluguel=0),n?(await $(E(A,"imoveis",n),{...r,atualizadoEm:z()}),alert("‚úÖ Terreno atualizado com sucesso!")):(await L(B(A,"imoveis"),{...r,criadoEm:z()}),alert("‚úÖ Terreno cadastrado com sucesso!")),g("/admin")}catch(a){console.error("Erro ao salvar:",a);const r=a instanceof Error?a.message:"Erro desconhecido";alert("‚ùå Erro ao salvar: "+r)}finally{h(!1),j(!1),p(0)}};return e.jsx("div",{className:"cadastro-container",children:e.jsxs("div",{className:"cadastro-content",children:[e.jsxs("div",{className:"cadastro-header",children:[e.jsxs(w,{to:"/admin",className:"back-link",children:[e.jsx(_,{size:18})," Voltar ao painel"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:n?"‚úèÔ∏è Editar Terreno":"üèûÔ∏è Cadastrar Novo Terreno"}),e.jsx("p",{className:"page-subtitle",children:n?"Atualize as informa√ß√µes do terreno":"Preencha os dados do novo terreno"})]}),!n&&e.jsx("button",{type:"button",onClick:D,style:{padding:"8px 16px",backgroundColor:"#e0e7ff",border:"1px solid #c7d2fe",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontWeight:"500",color:"#4f46e5"},children:"ü™Ñ Preencher com Dados de Teste"})]})]}),y.length>0&&e.jsxs("div",{className:"error-alert",children:[e.jsxs("div",{className:"error-header",children:[e.jsx(J,{size:20,color:"#ef4444"}),e.jsx("strong",{className:"error-title",children:"Corrija os seguintes erros:"})]}),e.jsx("ul",{className:"error-list",children:y.map((o,a)=>e.jsx("li",{children:o},a))})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìã Informa√ß√µes Principais"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"T√≠tulo do An√∫ncio *"}),e.jsx("input",{name:"titulo",value:s.titulo,onChange:i,className:"form-input",required:!0,placeholder:"Ex: Terreno Plano em Condom√≠nio Fechado"})]}),e.jsxs("div",{className:"grid-cols-adaptive",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Finalidade *"}),e.jsxs("select",{name:"tipo",value:s.tipo,onChange:i,className:"form-select",children:[e.jsx("option",{value:"Venda",children:"Venda"}),e.jsx("option",{value:"Aluguel",children:"Aluguel"}),e.jsx("option",{value:"Ambos",children:"Venda ou Aluguel"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:s.tipo==="Aluguel"?"Valor do Aluguel (R$) *":"Valor de Venda (R$) *"}),e.jsx("input",{name:"preco",type:"number",value:s.preco||"",onChange:i,className:"form-input",required:!0,placeholder:"150000"})]}),s.tipo==="Ambos"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Valor do Aluguel (R$) *"}),e.jsx("input",{name:"precoAluguel",type:"number",value:s.precoAluguel||"",onChange:i,className:"form-input",required:!0,placeholder:"1000"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìç Localiza√ß√£o"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Endere√ßo Completo *"}),e.jsx("input",{name:"endereco",value:s.endereco,onChange:i,className:"form-input",required:!0,placeholder:"Ex: Rua Projetada A, s/n"})]}),e.jsxs("div",{className:"grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Bairro *"}),e.jsx("input",{name:"bairro",value:s.bairro,onChange:i,className:"form-input",required:!0,placeholder:"Ex: Jardim America"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Cidade"}),e.jsx("input",{name:"cidade",value:s.cidade,onChange:i,className:"form-input",placeholder:"A√ßail√¢ndia"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üèûÔ∏è Detalhes do Terreno"}),e.jsxs("div",{className:"grid-cols-adaptive",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"√Årea Total (m¬≤) *"}),e.jsx("input",{name:"area",type:"number",value:s.area||"",onChange:i,className:"form-input",required:!0,placeholder:"300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Dimens√µes *"}),e.jsx("input",{name:"dimensoes",value:s.dimensoes||"",onChange:i,className:"form-input",required:!0,placeholder:"Ex: 10x30"})]})]}),e.jsxs("div",{className:"grid-cols-2",style:{marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Topografia"}),e.jsxs("select",{name:"topografia",value:s.topografia,onChange:i,className:"form-select",children:[e.jsx("option",{value:"Plano",children:"Plano"}),e.jsx("option",{value:"Aclive",children:"Aclive"}),e.jsx("option",{value:"Declive",children:"Declive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Zoneamento"}),e.jsxs("select",{name:"zoneamento",value:s.zoneamento,onChange:i,className:"form-select",children:[e.jsx("option",{value:"Residencial",children:"Residencial"}),e.jsx("option",{value:"Comercial",children:"Comercial"}),e.jsx("option",{value:"Misto",children:"Misto"}),e.jsx("option",{value:"Industrial",children:"Industrial"}),e.jsx("option",{value:"Rural",children:"Rural"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üí∞ Custos Adicionais"}),e.jsxs("div",{className:"grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Condom√≠nio (R$/m√™s)"}),e.jsx("input",{name:"condominio",type:"number",value:s.condominio||"",onChange:i,className:"form-input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"IPTU (R$/ano)"}),e.jsx("input",{name:"iptu",type:"number",value:s.iptu||"",onChange:i,className:"form-input",placeholder:"500"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üì∏ Fotos do Terreno *"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:I,className:"file-input"}),e.jsx(X,{size:48,className:"upload-icon"}),e.jsx("p",{className:"upload-title",children:"Clique ou arraste fotos aqui"}),e.jsx("p",{className:"upload-hint",children:"M√°ximo 10 fotos ‚Ä¢ JPG, PNG ou WEBP ‚Ä¢ M√°x 5MB cada"}),e.jsxs("p",{className:"upload-counter",children:[m.length,"/10 fotos adicionadas"]})]}),x&&e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${q}%`}})}),e.jsxs("p",{className:"progress-text",children:["Enviando fotos... ",q,"%"]})]}),m.length>0&&e.jsx("div",{className:"previews-grid",children:m.map((o,a)=>e.jsxs("div",{className:"preview-card",children:[a===0&&e.jsx("div",{className:"cover-badge",children:"CAPA"}),e.jsx("img",{src:o.includes("cloudinary")?G(o,300):o,alt:`Preview ${a+1}`,className:"preview-image"}),e.jsx("button",{type:"button",onClick:()=>M(a),className:"remove-image-btn",children:e.jsx(Z,{size:18})})]},a))})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìù Descri√ß√£o Detalhada"}),e.jsx("textarea",{name:"descricao",rows:8,value:s.descricao,onChange:i,className:"form-textarea",placeholder:"Descreva o terreno em detalhes: topografia, vizinhan√ßa, potencial construtivo, etc."}),e.jsxs("p",{className:"char-counter",children:[s.descricao.length," caracteres"]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"‚öôÔ∏è Configura√ß√µes de Publica√ß√£o"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("label",{className:"config-label",children:[e.jsx("input",{type:"checkbox",name:"ativo",checked:s.ativo,onChange:P,className:"config-checkbox"}),e.jsxs("div",{children:[e.jsx("strong",{className:"config-title",children:"Publicar Imediatamente"}),e.jsx("small",{className:"config-desc",children:"Desmarque para salvar como rascunho (n√£o aparecer√° no site)"})]})]}),e.jsxs("label",{className:`config-label ${s.destaque?"highlight":""}`,children:[e.jsx("input",{type:"checkbox",name:"destaque",checked:s.destaque,onChange:P,className:"config-checkbox"}),e.jsxs("div",{children:[e.jsx("strong",{className:"config-title",children:"‚≠ê Marcar como Destaque"}),e.jsx("small",{className:"config-desc",children:"Terreno aparecer√° com badge especial e ter√° prioridade na listagem"})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(w,{to:"/admin",className:"btn-cancel",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:C||x,className:"btn-submit",children:x?e.jsx(e.Fragment,{children:"üì§ Enviando imagens..."}):C?e.jsx(e.Fragment,{children:"üíæ Salvando..."}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:20}),n?"Atualizar Terreno":"Cadastrar Terreno"]})})]})]})]})})};export{ae as CadastroTerreno};
