import{h as T,a as B,j as e,d as A,I as P}from"./index-D_fitnc-.js";import{c as L,e as Q,r as n,L as k}from"./vendor-Bpbu6qE6.js";import{h as G,f as M,u as _,r as D,t as K,n as W}from"./firebase-Ctf_TYPz.js";import{o as J,u as Y}from"./CadastroForm-D-Kj14AA.js";import{A as O,y as X,z as H,X as Z,F as ee}from"./icons-HRjz0DnP.js";const re=()=>{const f=L(),{id:t}=Q(),{showToast:u}=T(),v=B(),[F,p]=n.useState(!1),[j,b]=n.useState(!1),[w,g]=n.useState(0),[N,C]=n.useState([]),[m,x]=n.useState([]),[I,E]=n.useState([]),[i,h]=n.useState({titulo:"",descricao:"",tipo:"Venda",preco:0,precoAluguel:0,endereco:"",bairro:"",cidade:"A√ßail√¢ndia",area:0,quartos:0,suites:0,banheiros:0,vagas:0,condominio:0,iptu:0,piscina:!1,churrasqueira:!1,elevador:!1,mobiliado:!1,portaria:!1,aceitaPet:!1,imagens:[],lat:-15.5518,lng:-54.298,ativo:!0,destaque:!1}),S=()=>{h({titulo:"Casa de Teste "+Math.floor(Math.random()*1e3),descricao:"Descri√ß√£o gen√©rica de um im√≥vel ador√°vel, espa√ßoso e bem localizado para testes r√°pidos do sistema. Possui v√°rios acabamentos modernos, excelente ilumina√ß√£o natural, e est√° pronto para morar.",tipo:"Venda",preco:3e5+Math.floor(Math.random()*5e5),precoAluguel:0,endereco:"Rua de Teste, "+Math.floor(Math.random()*1e3),bairro:"Bairro Gen√©rico",cidade:"A√ßail√¢ndia",area:150+Math.floor(Math.random()*100),quartos:3,suites:1,banheiros:2,vagas:2,condominio:300,iptu:1500,piscina:!0,churrasqueira:!0,elevador:!1,mobiliado:!1,portaria:!1,aceitaPet:!0,imagens:["https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=80"],lat:-15.5518,lng:-54.298,ativo:!0,destaque:!0}),x(["https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?auto=format&fit=crop&w=800&q=80","https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=80"]),C([]),E([])};n.useEffect(()=>{t&&(async()=>{p(!0);try{const s=await G(M(A,"imoveis",t));if(s.exists()){const l=s.data(),{id:r,...c}=l;h(c),x(c.imagens||[])}else u("Im√≥vel n√£o encontrado!","error"),f("/admin")}catch(s){console.error("Erro ao buscar:",s)}finally{p(!1)}})()},[t,f,u]);const o=a=>{const{name:s,value:l}=a.target,r=["preco","precoAluguel","area","quartos","banheiros","suites","vagas","condominio","iptu","lat","lng"].includes(s);h(c=>({...c,[s]:r?Number(l):l}))},y=a=>{const{name:s,checked:l}=a.target;h(r=>({...r,[s]:l}))},z=a=>{const s=a.target.files;if(!s||s.length===0)return;const l=Array.from(s);if(m.length+l.length>10){u(`M√°ximo 10 fotos. Atualmente h√° ${m.length} foto(s).`,"warning");return}if(l.filter(d=>d.size>5*1024*1024).length>0){u("Algumas imagens s√£o muito grandes (m√°x 5MB).","warning");return}C(d=>[...d,...l]),l.forEach(d=>{const q=new FileReader;q.onloadend=()=>{x(U=>[...U,q.result])},q.readAsDataURL(d)})},V=a=>{x(s=>s.filter((l,r)=>r!==a)),C(s=>s.filter((l,r)=>r!==a)),t&&h(s=>({...s,imagens:s.imagens.filter((l,r)=>r!==a)}))},R=()=>{const a=[];return i.titulo.trim()||a.push("T√≠tulo √© obrigat√≥rio"),i.preco<=0&&a.push("Pre√ßo deve ser maior que zero"),i.tipo==="Ambos"&&(!i.precoAluguel||i.precoAluguel<=0)&&a.push('Pre√ßo de aluguel √© obrigat√≥rio quando o tipo √© "Ambos"'),i.endereco.trim()||a.push("Endere√ßo √© obrigat√≥rio"),i.bairro.trim()||a.push("Bairro √© obrigat√≥rio"),m.length===0&&N.length===0&&a.push("Adicione pelo menos uma foto do im√≥vel"),E(a),a.length===0},$=async a=>{if(a.preventDefault(),!R()){window.scrollTo({top:0,behavior:"smooth"});return}p(!0);try{let s=[...i.imagens];if(N.length>0){b(!0),g(0);const r=setInterval(()=>{g(d=>Math.min(d+10,90))},200),c=await Y(N);s=[...s,...c],clearInterval(r),g(100),b(!1)}const l={...i,imagens:s};l.tipo!=="Ambos"&&(l.precoAluguel=0),t?(await _(M(A,"imoveis",t),{...l,atualizadoEm:D()}),v.invalidateQueries({queryKey:["imovel",t]}),v.invalidateQueries({queryKey:P}),alert("‚úÖ Im√≥vel atualizado com sucesso!")):(await K(W(A,"imoveis"),{...l,criadoEm:D()}),v.invalidateQueries({queryKey:P}),alert("‚úÖ Im√≥vel cadastrado com sucesso!")),f("/admin")}catch(s){console.error("Erro ao salvar:",s);const l=s instanceof Error?s.message:"Erro desconhecido";u("Erro ao salvar: "+l,"error")}finally{p(!1),b(!1),g(0)}};return e.jsx("div",{className:"cadastro-container",children:e.jsxs("div",{className:"cadastro-content",children:[e.jsxs("div",{className:"cadastro-header",children:[e.jsxs(k,{to:"/admin",className:"back-link",children:[e.jsx(O,{size:18})," Voltar ao painel"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:t?"‚úèÔ∏è Editar Im√≥vel":"üè† Cadastrar Novo Im√≥vel"}),e.jsx("p",{className:"page-subtitle",children:t?"Atualize as informa√ß√µes do im√≥vel":"Preencha os dados do novo im√≥vel"})]}),!t&&e.jsx("button",{type:"button",onClick:S,style:{padding:"8px 16px",backgroundColor:"#e0e7ff",border:"1px solid #c7d2fe",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontWeight:"500",color:"#4f46e5"},children:"ü™Ñ Preencher com Dados de Teste"})]})]}),I.length>0&&e.jsxs("div",{className:"error-alert",children:[e.jsxs("div",{className:"error-header",children:[e.jsx(X,{size:20,color:"#ef4444"}),e.jsx("strong",{className:"error-title",children:"Corrija os seguintes erros:"})]}),e.jsx("ul",{className:"error-list",children:I.map((a,s)=>e.jsx("li",{children:a},s))})]}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìã Informa√ß√µes Principais"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"titulo-input",children:"T√≠tulo do An√∫ncio *"}),e.jsx("input",{id:"titulo-input",name:"titulo",value:i.titulo,onChange:o,className:"form-input",required:!0,placeholder:"Ex: Apartamento Moderno no Centro com Vista"})]}),e.jsxs("div",{className:"grid-cols-adaptive",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"tipo-select",children:"Finalidade *"}),e.jsxs("select",{id:"tipo-select",name:"tipo",value:i.tipo,onChange:o,className:"form-select",children:[e.jsx("option",{value:"Venda",children:"Venda"}),e.jsx("option",{value:"Aluguel",children:"Aluguel"}),e.jsx("option",{value:"Ambos",children:"Venda ou Aluguel"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"preco-input",children:i.tipo==="Aluguel"?"Valor do Aluguel (R$) *":"Valor de Venda (R$) *"}),e.jsx("input",{id:"preco-input",name:"preco",type:"number",value:i.preco||"",onChange:o,className:"form-input",required:!0,placeholder:"350000"})]}),i.tipo==="Ambos"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"preco-aluguel-input",children:"Valor do Aluguel (R$) *"}),e.jsx("input",{id:"preco-aluguel-input",name:"precoAluguel",type:"number",value:i.precoAluguel||"",onChange:o,className:"form-input",required:!0,placeholder:"2500"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìç Localiza√ß√£o"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"endereco-input",children:"Endere√ßo Completo *"}),e.jsx("input",{id:"endereco-input",name:"endereco",value:i.endereco,onChange:o,className:"form-input",required:!0,placeholder:"Ex: Rua das Palmeiras, 123"})]}),e.jsxs("div",{className:"grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"bairro-input",children:"Bairro *"}),e.jsx("input",{id:"bairro-input",name:"bairro",value:i.bairro,onChange:o,className:"form-input",required:!0,placeholder:"Ex: Jardim Imperial"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"cidade-input",children:"Cidade"}),e.jsx("input",{id:"cidade-input",name:"cidade",value:i.cidade,onChange:o,className:"form-input",placeholder:"A√ßail√¢ndia"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üè° Caracter√≠sticas do Im√≥vel"}),e.jsxs("div",{className:"grid-cols-small",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"area-input",children:"√Årea (m¬≤)"}),e.jsx("input",{id:"area-input",name:"area",type:"number",value:i.area||"",onChange:o,className:"form-input",placeholder:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"quartos-input",children:"Quartos"}),e.jsx("input",{id:"quartos-input",name:"quartos",type:"number",value:i.quartos||"",onChange:o,className:"form-input",placeholder:"3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"suites-input",children:"Su√≠tes"}),e.jsx("input",{id:"suites-input",name:"suites",type:"number",value:i.suites||"",onChange:o,className:"form-input",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"banheiros-input",children:"Banheiros"}),e.jsx("input",{id:"banheiros-input",name:"banheiros",type:"number",value:i.banheiros||"",onChange:o,className:"form-input",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"vagas-input",children:"Vagas"}),e.jsx("input",{id:"vagas-input",name:"vagas",type:"number",value:i.vagas||"",onChange:o,className:"form-input",placeholder:"2"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üí∞ Custos Adicionais"}),e.jsxs("div",{className:"grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"condominio-input",children:"Condom√≠nio (R$/m√™s)"}),e.jsx("input",{id:"condominio-input",name:"condominio",type:"number",value:i.condominio||"",onChange:o,className:"form-input",placeholder:"450"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"iptu-input",children:"IPTU (R$/ano)"}),e.jsx("input",{id:"iptu-input",name:"iptu",type:"number",value:i.iptu||"",onChange:o,className:"form-input",placeholder:"1200"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"‚ú® Comodidades"}),e.jsx("div",{className:"comodidades-grid",children:[{name:"piscina",label:"üèä Piscina"},{name:"churrasqueira",label:"üî• Churrasqueira"},{name:"elevador",label:"üõó Elevador"},{name:"mobiliado",label:"üõãÔ∏è Mobiliado"},{name:"portaria",label:"üö™ Portaria 24h"},{name:"aceitaPet",label:"üêï Aceita Pet"}].map(a=>e.jsxs("label",{className:`comodidade-label ${i[a.name]?"active":""}`,htmlFor:`comodidade-${a.name}`,children:[e.jsx("input",{id:`comodidade-${a.name}`,type:"checkbox",name:a.name,checked:i[a.name],onChange:y,className:"comodidade-checkbox"}),e.jsx("span",{className:"comodidade-text",children:a.label})]},a.name))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üì∏ Fotos do Im√≥vel *"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",multiple:!0,onChange:z,className:"file-input","aria-label":"Selecionar fotos do im√≥vel"}),e.jsxs("label",{htmlFor:"image-upload",className:"upload-label-wrapper",style:{cursor:"pointer",display:"block",width:"100%"},children:[e.jsx(H,{size:48,className:"upload-icon"}),e.jsx("p",{className:"upload-title",children:"Clique ou arraste fotos aqui"}),e.jsx("p",{className:"upload-hint",children:"M√°ximo 10 fotos ‚Ä¢ JPG, PNG ou WEBP ‚Ä¢ M√°x 5MB cada"})]}),e.jsxs("p",{className:"upload-counter",children:[m.length,"/10 fotos adicionadas"]})]}),j&&e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${w}%`}})}),e.jsxs("p",{className:"progress-text",children:["Enviando fotos... ",w,"%"]})]}),m.length>0&&e.jsx("div",{className:"previews-grid",children:m.map((a,s)=>e.jsxs("div",{className:"preview-card",children:[s===0&&e.jsx("div",{className:"cover-badge",children:"CAPA"}),e.jsx("img",{src:a.includes("cloudinary")?J(a,300):a,alt:`Preview ${s+1}`,className:"preview-image"}),e.jsx("button",{type:"button",onClick:()=>V(s),className:"remove-image-btn",children:e.jsx(Z,{size:18})})]},s))})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìù Descri√ß√£o Detalhada"}),e.jsx("label",{htmlFor:"descricao-textarea",className:"sr-only","aria-hidden":"true",style:{display:"none"},children:"Descri√ß√£o"}),e.jsx("textarea",{id:"descricao-textarea",name:"descricao",rows:8,value:i.descricao,onChange:o,className:"form-textarea",placeholder:"Descreva o im√≥vel em detalhes: acabamentos, localiza√ß√£o, diferenciais, proximidade de com√©rcios, escolas, etc."}),e.jsxs("p",{className:"char-counter",children:[i.descricao.length," caracteres"]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"‚öôÔ∏è Configura√ß√µes de Publica√ß√£o"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("label",{className:"config-label",htmlFor:"ativo-checkbox",children:[e.jsx("input",{id:"ativo-checkbox",type:"checkbox",name:"ativo",checked:i.ativo,onChange:y,className:"config-checkbox"}),e.jsxs("div",{children:[e.jsx("strong",{className:"config-title",children:"Publicar Imediatamente"}),e.jsx("small",{className:"config-desc",children:"Desmarque para salvar como rascunho (n√£o aparecer√° no site)"})]})]}),e.jsxs("label",{className:`config-label ${i.destaque?"highlight":""}`,htmlFor:"destaque-checkbox",children:[e.jsx("input",{id:"destaque-checkbox",type:"checkbox",name:"destaque",checked:i.destaque,onChange:y,className:"config-checkbox"}),e.jsxs("div",{children:[e.jsx("strong",{className:"config-title",children:"‚≠ê Marcar como Destaque"}),e.jsx("small",{className:"config-desc",children:"Im√≥vel aparecer√° com badge especial e ter√° prioridade na listagem"})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(k,{to:"/admin",className:"btn-cancel",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:F||j,className:"btn-submit",children:j?e.jsx(e.Fragment,{children:"üì§ Enviando imagens..."}):F?e.jsx(e.Fragment,{children:"üíæ Salvando..."}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:20}),t?"Atualizar Im√≥vel":"Cadastrar Im√≥vel"]})})]})]})]})})};export{re as CadastroImovel};
