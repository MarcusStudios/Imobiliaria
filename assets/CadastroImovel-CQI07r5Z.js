import{j as e,d as A}from"./index-BuVYEssn.js";import{e as V,d as _,r as d,L as w}from"./vendor-DPpvCZNn.js";import{h as $,f as q,u as M,q as I,r as R,n as L}from"./firebase-DqZlsiQC.js";import{A as T,v as B,w as G,X as O,x as J}from"./icons-D6G6rgYq.js";const Q="dj16hchjj",W="imoveis_preset",X=async c=>{const r=new FormData;r.append("file",c),r.append("upload_preset",W),r.append("folder","imoveis");try{const t=await fetch(`https://api.cloudinary.com/v1_1/${Q}/image/upload`,{method:"POST",body:r});if(!t.ok)throw new Error("Erro ao fazer upload da imagem");return(await t.json()).secure_url}catch(t){throw console.error("Erro no upload:",t),t}},H=async c=>{try{const r=c.map(m=>X(m));return await Promise.all(r)}catch(r){throw console.error("Erro ao fazer upload de m√∫ltiplas imagens:",r),r}},K=(c,r=800)=>c.includes("cloudinary.com")?c.replace("/upload/",`/upload/w_${r},q_auto,f_auto/`):c,se=()=>{const c=V(),{id:r}=_(),[t,m]=d.useState(!1),[v,j]=d.useState(!1),[y,g]=d.useState(0),[f,E]=d.useState([]),[p,b]=d.useState([]),[P,D]=d.useState([]),[l,x]=d.useState({titulo:"",descricao:"",tipo:"Venda",preco:0,precoAluguel:0,endereco:"",bairro:"",cidade:"A√ßail√¢ndia",area:0,quartos:0,suites:0,banheiros:0,vagas:0,condominio:0,iptu:0,piscina:!1,churrasqueira:!1,elevador:!1,mobiliado:!1,portaria:!1,aceitaPet:!1,imagens:[],lat:-15.5518,lng:-54.298,ativo:!0,destaque:!1});d.useEffect(()=>{r&&(async()=>{m(!0);try{const a=await $(q(A,"imoveis",r));if(a.exists()){const o=a.data(),{id:n,...u}=o;x(u),b(u.imagens||[])}else alert("Im√≥vel n√£o encontrado!"),c("/admin")}catch(a){console.error("Erro ao buscar:",a)}finally{m(!1)}})()},[r,c]);const i=s=>{const{name:a,value:o}=s.target,n=["preco","precoAluguel","area","quartos","banheiros","suites","vagas","condominio","iptu","lat","lng"].includes(a);x(u=>({...u,[a]:n?Number(o):o}))},N=s=>{const{name:a,checked:o}=s.target;x(n=>({...n,[a]:o}))},k=s=>{const a=s.target.files;if(!a||a.length===0)return;const o=Array.from(a);if(p.length+o.length>10){alert(`Voc√™ pode adicionar no m√°ximo 10 fotos. Atualmente h√° ${p.length} foto(s).`);return}if(o.filter(h=>h.size>5*1024*1024).length>0){alert("Algumas imagens s√£o muito grandes (m√°x 5MB). Por favor, comprima-as antes de fazer upload.");return}E(h=>[...h,...o]),o.forEach(h=>{const C=new FileReader;C.onloadend=()=>{b(U=>[...U,C.result])},C.readAsDataURL(h)})},z=s=>{b(a=>a.filter((o,n)=>n!==s)),E(a=>a.filter((o,n)=>n!==s)),r&&x(a=>({...a,imagens:a.imagens.filter((o,n)=>n!==s)}))},S=()=>{const s=[];return l.titulo.trim()||s.push("T√≠tulo √© obrigat√≥rio"),l.preco<=0&&s.push("Pre√ßo deve ser maior que zero"),l.tipo==="Ambos"&&(!l.precoAluguel||l.precoAluguel<=0)&&s.push('Pre√ßo de aluguel √© obrigat√≥rio quando o tipo √© "Ambos"'),l.endereco.trim()||s.push("Endere√ßo √© obrigat√≥rio"),l.bairro.trim()||s.push("Bairro √© obrigat√≥rio"),p.length===0&&f.length===0&&s.push("Adicione pelo menos uma foto do im√≥vel"),D(s),s.length===0},F=async s=>{if(s.preventDefault(),!S()){window.scrollTo({top:0,behavior:"smooth"});return}m(!0);try{let a=[...l.imagens];if(f.length>0){j(!0),g(0);const n=setInterval(()=>{g(h=>Math.min(h+10,90))},200),u=await H(f);a=[...a,...u],clearInterval(n),g(100),j(!1)}const o={...l,imagens:a};o.tipo!=="Ambos"&&(o.precoAluguel=0),r?(await M(q(A,"imoveis",r),{...o,atualizadoEm:I()}),alert("‚úÖ Im√≥vel atualizado com sucesso!")):(await R(L(A,"imoveis"),{...o,criadoEm:I()}),alert("‚úÖ Im√≥vel cadastrado com sucesso!")),c("/admin")}catch(a){console.error("Erro ao salvar:",a);const o=a instanceof Error?a.message:"Erro desconhecido";alert("‚ùå Erro ao salvar: "+o)}finally{m(!1),j(!1),g(0)}};return e.jsx("div",{className:"cadastro-container",children:e.jsxs("div",{className:"cadastro-content",children:[e.jsxs("div",{className:"cadastro-header",children:[e.jsxs(w,{to:"/admin",className:"back-link",children:[e.jsx(T,{size:18})," Voltar ao painel"]}),e.jsx("h1",{className:"page-title",children:r?"‚úèÔ∏è Editar Im√≥vel":"üè† Cadastrar Novo Im√≥vel"}),e.jsx("p",{className:"page-subtitle",children:r?"Atualize as informa√ß√µes do im√≥vel":"Preencha os dados do novo im√≥vel"})]}),P.length>0&&e.jsxs("div",{className:"error-alert",children:[e.jsxs("div",{className:"error-header",children:[e.jsx(B,{size:20,color:"#ef4444"}),e.jsx("strong",{className:"error-title",children:"Corrija os seguintes erros:"})]}),e.jsx("ul",{className:"error-list",children:P.map((s,a)=>e.jsx("li",{children:s},a))})]}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìã Informa√ß√µes Principais"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"T√≠tulo do An√∫ncio *"}),e.jsx("input",{name:"titulo",value:l.titulo,onChange:i,className:"form-input",required:!0,placeholder:"Ex: Apartamento Moderno no Centro com Vista"})]}),e.jsxs("div",{className:"grid-cols-adaptive",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Finalidade *"}),e.jsxs("select",{name:"tipo",value:l.tipo,onChange:i,className:"form-select",children:[e.jsx("option",{value:"Venda",children:"Venda"}),e.jsx("option",{value:"Aluguel",children:"Aluguel"}),e.jsx("option",{value:"Ambos",children:"Venda ou Aluguel"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:l.tipo==="Aluguel"?"Valor do Aluguel (R$) *":"Valor de Venda (R$) *"}),e.jsx("input",{name:"preco",type:"number",value:l.preco||"",onChange:i,className:"form-input",required:!0,placeholder:"350000"})]}),l.tipo==="Ambos"&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Valor do Aluguel (R$) *"}),e.jsx("input",{name:"precoAluguel",type:"number",value:l.precoAluguel||"",onChange:i,className:"form-input",required:!0,placeholder:"2500"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìç Localiza√ß√£o"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Endere√ßo Completo *"}),e.jsx("input",{name:"endereco",value:l.endereco,onChange:i,className:"form-input",required:!0,placeholder:"Ex: Rua das Palmeiras, 123"})]}),e.jsxs("div",{className:"grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Bairro *"}),e.jsx("input",{name:"bairro",value:l.bairro,onChange:i,className:"form-input",required:!0,placeholder:"Ex: Jardim Imperial"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Cidade"}),e.jsx("input",{name:"cidade",value:l.cidade,onChange:i,className:"form-input",placeholder:"A√ßail√¢ndia"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üè° Caracter√≠sticas do Im√≥vel"}),e.jsxs("div",{className:"grid-cols-small",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"√Årea (m¬≤)"}),e.jsx("input",{name:"area",type:"number",value:l.area||"",onChange:i,className:"form-input",placeholder:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Quartos"}),e.jsx("input",{name:"quartos",type:"number",value:l.quartos||"",onChange:i,className:"form-input",placeholder:"3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Su√≠tes"}),e.jsx("input",{name:"suites",type:"number",value:l.suites||"",onChange:i,className:"form-input",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Banheiros"}),e.jsx("input",{name:"banheiros",type:"number",value:l.banheiros||"",onChange:i,className:"form-input",placeholder:"2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Vagas"}),e.jsx("input",{name:"vagas",type:"number",value:l.vagas||"",onChange:i,className:"form-input",placeholder:"2"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üí∞ Custos Adicionais"}),e.jsxs("div",{className:"grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Condom√≠nio (R$/m√™s)"}),e.jsx("input",{name:"condominio",type:"number",value:l.condominio||"",onChange:i,className:"form-input",placeholder:"450"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"IPTU (R$/ano)"}),e.jsx("input",{name:"iptu",type:"number",value:l.iptu||"",onChange:i,className:"form-input",placeholder:"1200"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"‚ú® Comodidades"}),e.jsx("div",{className:"comodidades-grid",children:[{name:"piscina",label:"üèä Piscina"},{name:"churrasqueira",label:"üî• Churrasqueira"},{name:"elevador",label:"üõó Elevador"},{name:"mobiliado",label:"üõãÔ∏è Mobiliado"},{name:"portaria",label:"üö™ Portaria 24h"},{name:"aceitaPet",label:"üêï Aceita Pet"}].map(s=>e.jsxs("label",{className:`comodidade-label ${l[s.name]?"active":""}`,children:[e.jsx("input",{type:"checkbox",name:s.name,checked:l[s.name],onChange:N,className:"comodidade-checkbox"}),e.jsx("span",{className:"comodidade-text",children:s.label})]},s.name))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üì∏ Fotos do Im√≥vel *"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:k,className:"file-input"}),e.jsx(G,{size:48,className:"upload-icon"}),e.jsx("p",{className:"upload-title",children:"Clique ou arraste fotos aqui"}),e.jsx("p",{className:"upload-hint",children:"M√°ximo 10 fotos ‚Ä¢ JPG, PNG ou WEBP ‚Ä¢ M√°x 5MB cada"}),e.jsxs("p",{className:"upload-counter",children:[p.length,"/10 fotos adicionadas"]})]}),v&&e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar-bg",children:e.jsx("div",{className:"progress-bar-fill",style:{width:`${y}%`}})}),e.jsxs("p",{className:"progress-text",children:["Enviando fotos... ",y,"%"]})]}),p.length>0&&e.jsx("div",{className:"previews-grid",children:p.map((s,a)=>e.jsxs("div",{className:"preview-card",children:[a===0&&e.jsx("div",{className:"cover-badge",children:"CAPA"}),e.jsx("img",{src:s.includes("cloudinary")?K(s,300):s,alt:`Preview ${a+1}`,className:"preview-image"}),e.jsx("button",{type:"button",onClick:()=>z(a),className:"remove-image-btn",children:e.jsx(O,{size:18})})]},a))})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"üìù Descri√ß√£o Detalhada"}),e.jsx("textarea",{name:"descricao",rows:8,value:l.descricao,onChange:i,className:"form-textarea",placeholder:"Descreva o im√≥vel em detalhes: acabamentos, localiza√ß√£o, diferenciais, proximidade de com√©rcios, escolas, etc."}),e.jsxs("p",{className:"char-counter",children:[l.descricao.length," caracteres"]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"‚öôÔ∏è Configura√ß√µes de Publica√ß√£o"}),e.jsxs("div",{className:"grid-gap-1-5",children:[e.jsxs("label",{className:"config-label",children:[e.jsx("input",{type:"checkbox",name:"ativo",checked:l.ativo,onChange:N,className:"config-checkbox"}),e.jsxs("div",{children:[e.jsx("strong",{className:"config-title",children:"Publicar Imediatamente"}),e.jsx("small",{className:"config-desc",children:"Desmarque para salvar como rascunho (n√£o aparecer√° no site)"})]})]}),e.jsxs("label",{className:`config-label ${l.destaque?"highlight":""}`,children:[e.jsx("input",{type:"checkbox",name:"destaque",checked:l.destaque,onChange:N,className:"config-checkbox"}),e.jsxs("div",{children:[e.jsx("strong",{className:"config-title",children:"‚≠ê Marcar como Destaque"}),e.jsx("small",{className:"config-desc",children:"Im√≥vel aparecer√° com badge especial e ter√° prioridade na listagem"})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx(w,{to:"/admin",className:"btn-cancel",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:t||v,className:"btn-submit",children:v?e.jsx(e.Fragment,{children:"üì§ Enviando imagens..."}):t?e.jsx(e.Fragment,{children:"üíæ Salvando..."}):e.jsxs(e.Fragment,{children:[e.jsx(J,{size:20}),r?"Atualizar Im√≥vel":"Cadastrar Im√≥vel"]})})]})]})]})})};export{se as CadastroImovel};
